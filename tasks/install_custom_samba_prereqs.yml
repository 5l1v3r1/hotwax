---
# From: https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&p=73263
#
# It seems that the more recent smbclient/rpcclient tools enforce usage of 
#  security signatures during SMB session negotiation. I compared the traffic
#  from rpcclient with the one generated from nmap smb enumeration scripts.
# The nmap enumeration scripts worked, i.e. were able to setup a session. 
# I saw that rpcclient sets the 'Security Signatures Required' flag whereas 
#  nmap does not. If you have an idea why this might prevent session setup, 
# I would be happy about a message.
# Anyway, you can fix this by downloading and compiling an older version of samba:
# https://github.com/samba-team/samba/archive/samba-4.5.16.tar.gz

- name: Install Samba compilation prerequisites
  apt:
    name: "{{ packages }}"
    update_cache: yes
    state: present
  vars:
    packages:
    - acl
    - apt-utils
    - attr
    - autoconf
    - bind9utils
    - binutils
    - bison
    - build-essential
    - curl
    - debhelper
    - dnsutils
    - docbook-xml
    - docbook-xsl
    - flex
    - gcc
    - gdb
    - git
    - glusterfs-common
    - gzip
    - heimdal-clients
    - heimdal-dev
    - heimdal-kcm
    - heimdal-multidev
    - hostname
    - htop
    - krb5-config
    - lcov
    - libacl1-dev
    - libaio-dev
    - libarchive-dev
    - libattr1-dev
    - libavahi-client-dev
    - libavahi-common-dev
    - libblkid-dev
    - libbsd-dev
    - libcap-dev
    - libcups2-dev
    - libdbus-1-dev
    - libfam-dev
    - libgcrypt20-dev
    - libglib2.0-dev
    - libglusterfs-dev
    - libgnutls28-dev
    - libgpgme-dev
    - libgssapi3-heimdal
    - libicu-dev
    - libjansson-dev
    - libjs-jquery
    - libjson-perl
    - libkadm5clnt7-heimdal
    - libkadm5srv8-heimdal
    - libkafs0-heimdal
    - libkdc2-heimdal
    - libkrb5-26-heimdal
    - libldap2-dev
    - libldb-dev
    - liblmdb-dev
    - liblttng-ust-dev
    - libmd-dev
    - libmhash-dev
    - libncurses5-dev
    - libotp0-heimdal
    - libpam0g-dev
    - libparse-yapp-perl
    - libpcap-dev
    - libpopt-dev
    - libreadline-gplv2-dev
    - libsl0-heimdal
    - libssl1.0-dev
    - libsystemd-dev
    - libtalloc-dev
    - libtasn1-6-dev
    - libtasn1-bin
    - libtdb-dev
    - libtevent-dev
    - libunwind-dev
    - lmdb-utils
    - locales
    - lsb-release
    - make
    - mawk
    - mingw-w64
    - nettle-dev
    - patch
    - perl
    - perl-modules-5.28
    - pkg-config
    - procps
    - psmisc
    - python-crypto
    - python-dbg
    - python-dev
    - python-dnspython
    - python-gnupg
    - python-iso8601
    - python-markdown
    - python-pexpect
    - python-talloc-dev
    - python3
    - python3-crypto
    - python3-dbg
    - python3-dev
    - python3-dnspython
    - python3-gnupg
    - python3-iso8601
    - python3-markdown
    - python3-matplotlib
    - python3-pexpect
    - rsync
    - sed
    - sudo
    - tar
    - tree
    - uuid-dev
    - xfslibs-dev
    - xsltproc
    - zlib1g-dev